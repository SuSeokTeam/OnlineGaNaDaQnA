package CONTROL;

import java.util.ArrayList;

import kr.kaist.ir.korean.data.TaggedSentence;
import kr.kaist.ir.korean.parser.KkokkomaParser;
import DATA.*;

public class ExtractTopic {

	QADB qadb = null;
	KkokkomaParser iParser = null;
	
	public ExtractTopic(String dbName)
	{
		qadb = new QADB(dbName);
		iParser = new KkokkomaParser();
	}
	
	public void extractTopic(String type)
	{
		ArrayList<QA> qaList = qadb.selectCQA();
		
		for(int i=0; i<qaList.size(); i++)
		{
			QA q = qaList.get(i);
			splitSentece(q, type);
		}
	}

	public void splitSentece(QA qa, String type)
	{
		ArrayList<String> sentenceList = new ArrayList<String>();
		String sentence = "";
		String nextSentence = "";
		
		if(type.equals("Q"))
		{
			sentence = qa.getQuestion();
		}
		else
		{
			sentence = qa.getAnswer();
		}
		sentenceList.add(sentence);
		int id = qa.getNum();
		int index = -1;
		for(int i=0; i< sentenceList.size(); i++)
		{
			sentence = sentenceList.get(i);
			try {
				TaggedSentence ts = iParser.dependencyOf(sentence);
				
				nextSentence = ts.getOriginalString(null);
				System.out.println(id + " : " + nextSentence+ " : " + i +  " : " +  type );
				
				if(sentence.equals(nextSentence))
				{
			//		qadb.insertKeyword(id, nextSentence, i, type);
				}
				else
				{
					index = getIndex(sentence, nextSentence);
					if(index < sentence.length())
					{
						nextSentence = sentence.substring(index);
						sentenceList.add(nextSentence);
					}
				}
			} catch (Exception e) {
				// TODO Auto-generated catch block
				e.printStackTrace();
			}
			
		}
	}
	
	public int getIndex(String sentence, String splitSentence)
	{
		int j =0; 
		int i =0;
		char a  = ' ';
		char b = ' ';
		while(true)
		{
			if(sentence.length() <= i | splitSentence.length() <= j)
				break;
			a = sentence.charAt(i);
			b = splitSentence.charAt(j);
			if(a == ' ')
			{
				i++;
				if(sentence.length() <= i)
					break;
				a = sentence.charAt(i);
			}
			if(b == ' ')
			{
				j++;
				if(splitSentence.length() <= j)
					break;
				b = splitSentence.charAt(j);
			}
			
			if( a == b)
			{
				i++;
				j++;
			}
			else
			{
				break;
			}
		}
		return i;
	}
	
	public void getDepedent(TaggedSentence ts)
	{
		
	}
	public void getKeyword()
	{
		
	}

	
}
